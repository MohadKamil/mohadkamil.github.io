<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Serverless budget tracking &middot;  kimo&#39;s blog" />
  
  <meta name="theme-color" content="#hexcolor" />
 
  <meta property="og:site_name" content="kimo&#39;s blog" />
  <meta property="og:url" content="https://mohadkamil.tech/posts/serverless-budget-tracking/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2021-05-12T00:31:26&#43;04:00" />
  
  

  <title>
     Serverless budget tracking &middot;  kimo&#39;s blog
  </title>

  <link rel="stylesheet" href="https://mohadkamil.tech/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://mohadkamil.tech/css/main.css" />
  <link rel="stylesheet" href="https://mohadkamil.tech/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://mohadkamil.tech/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="https://mohadkamil.tech/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://mohadkamil.tech/images/apple-touch-icon.png" />
  
</head>
<body>
    <header class="global-header"  style="background-image:url( /images/bg.jpg )">
    <section class="header-text">
      <h1><a href="https://mohadkamil.tech/">kimo&#39;s blog</a></h1>
      
      <div class="tag-line">
        An area where the developer and the geek side of me writes and blogs
      </div>
      
      <div class="sns-links hidden-print">
  
  
  <a href="https://twitter.com/kamlan19922" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/mohadkamil" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  
  <a href="https://linkedin.com/in/mohammed-kamil-80bb0495" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
</div>

      
      <a href="https://mohadkamil.tech/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
      
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">Serverless budget tracking</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2021-05-12T00:31:26&#43;04:00">
          May 12, 2021
        </time>
      </div>
    
      <div class="pull-right">
        
      </div>
    </div>
  </header>
  <section>
    <p>I use a very neat application to bugdet and track my spending, or let me confess,
I&rsquo;ve been trying to use this bugeting app to but a lid on my careless spending habit,
YNAB (You need a budget) is an application for budgeting your income with a great philosphy 
behind it: &ldquo;you give every dollar a job&rdquo;.</p>
<p>One of the things I&rsquo;ve been failing at is tracking each payment, while adding transaction
to the app is user friendly, but doing so for every payment you do however small is tiresome,
that&rsquo;s why when I started using card payment for all of my purchase, an idea came to me.</p>
<p>My bank sends me an sms for each payment done with either of the the cards I have, this message
include the amount paid, and the name of the payment recciever, these two are what you need
to add a transaction to YNAB, so let&rsquo;s automate it.</p>
<p><img src="https://app.diagrams.net/?lightbox=1&amp;highlight=FFFFFF&amp;edit=_blank&amp;layers=1&amp;nav=1&amp;title=YNABAutomation.drawio#R1VZNb5wwEP01HLfiY9kkx%2B1m06ZtqlWQ2uQ4whNwZTAyQ4D%2B%2BtpgFhDKKpXabnOxPM8zHs%2BbeQIn2GXNBwVFeicZCsd3WeME147vX1z6ejVA2wPrzVUPJIqzHvJGIOI%2F0YKuRSvOsJw5kpSCeDEHY5nnGNMMA6VkPXd7kmKetYAEF0AUg1ii3zmjtEcvQ3fEPyJP0iGz59qTDAZnC5QpMFlPoGDvBDslJfW7rNmhMNwNvPRxNy%2BcHh%2BmMKfXBASfve1Nu%2F50e384bC5WK%2B8bK1dr%2BzZqh4KR6fqtKRWlMpE5iP2IvleyyhmaW11tjT5fpCw06GnwBxK1tplQkdRQSpmwp9hwepjsH81V70JrXTf25s5ordG%2F0zzuxfItVMpKxXii5mGMQCVIJ%2Fz8Y5P0cKPMkFSr4xQKIP48fwfYMUuOfmMn9MY24zcaY%2B99BlHZTAcw2YHMYsrUI1oaBiTPDVaVPE%2BMEECxRVPnLatTThgV0LFUa9nO22MzoyJsTpO9JMcGbOzMt4OYrV2PEvIGXaQT%2BQxxf5zOzVuZc02wah%2BmxiTKmGNYZ%2F0Fffiv1Ed4Tn34C33cY4wmrU6W6yW6i7qB0%2FOma0mxI6PNsBMLQwIuyrPrxL%2F634QSLnjdQRf1%2BHWrK3a3h9vuE2xyM3aklhTkJcTEZX52UkP%2F35GqzfEL3p1NfoOC%2FS8%3D" alt="Automation flow"></p>
<p>What makes automating of transaction entry is that YNAB provide an <a href="https://api.youneedabudget.com/v1">API</a> for that,
we just need to call the API to add a transaction for each SMS received.</p>
<p>I decieded to use azure function to do recieve the sms message, decode the payment, 
and call YNAB api</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#a6e22e">[FunctionName(&#34;AddTransaction&#34;)]</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;IActionResult&gt; AddTransaction([HttpTrigger(AuthorizationLevel.Function, <span style="color:#e6db74">&#34;post&#34;</span>, Route = <span style="color:#66d9ef">null</span>)] <span style="color:#66d9ef">string</span> purchaseSms)
{
    <span style="color:#ae81ff">_l</span>ogger.LogInformation(<span style="color:#e6db74">&#34;received new sms for processing sms text: {sms}&#34;</span>,purchaseSms);
    <span style="color:#66d9ef">var</span> numbers = Regex.Matches(purchaseSms, DecimalsExpression, RegexOptions.None);
    <span style="color:#66d9ef">var</span> payee = Regex.Matches(purchaseSms, PayeeExpression, RegexOptions.None)[<span style="color:#ae81ff">0</span>].Value.Replace(<span style="color:#e6db74">&#34;at&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>).Trim();
    <span style="color:#66d9ef">var</span> transaction = <span style="color:#66d9ef">new</span> TransactionRequest
    {
        transaction = <span style="color:#66d9ef">new</span> Transaction
        {
            account_id = YnabConstants.NBDDebitAccountId,
            amount = -numbers[<span style="color:#ae81ff">0</span>].Value.ToYnabMilliUnit(),
            payee_name = payee,
            approved = <span style="color:#66d9ef">true</span>,
            memo = purchaseSms,
            date = DateTime.UtcNow.ToString(YnabConstants.DateFormat),
            category_id = YnabConstants.TempCategory,
        }
    };
    <span style="color:#66d9ef">await</span> <span style="color:#ae81ff">_</span>ynabapi.AddTransaction(YnabConstants.BudgetId,transaction);

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> OkResult();
}

</code></pre></div><p>The function is going to be an http triggered function (I will tell you in a moment how it will be triggered),
getting the payment sms, will extract the payment amount, and the name of the payment recciever to be used as payee 
in YNAB, next it will construct a transaction object capturing this transaction info, and then commit
it to YNAB api using refit generated api implementation</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> IYnabapi
{
<span style="color:#a6e22e">    [Post(&#34;/budgets/{budgetId}/transactions&#34;)]</span>
    Task AddTransaction(<span style="color:#66d9ef">string</span> budgetId, [Body] TransactionRequest transactionRequest);
}
</code></pre></div><h3 id="calling-triggering-the-function">Calling (Triggering) the function</h3>
<p>To trigger the function I need to make a post request to its url, passing the sms as the content,
to do that I decided to use IFTTT.</p>
<p>The two recepies I&rsquo;m using is the Andoind sms and the webhook.
the first one (Android sms) tracks the recieved sms matching a pattern to my phone, matched sms gets passes to the second item in the recepie,
the webhook, this recieves the sms text and makes a POST call to my function url, triggering the function (the part I mentioned earlier).</p>
<p>with this payments I do on my card gets added to YNAP as transaction.</p>

  </section>
  <footer>
    
    
    <hr/>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'mohadkamil-github-io';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
    <section class="author-info row">
      <div class="author-avatar col-md-2">
        
        <img alt="Author Avatar" src="/avatars/avatar.jpg" />
        
      </div>
      <div class="author-meta col-md-6">
        
        <h1 class="author-name text-primary">Mohammed Kamil</h1>
        
        
        <div class="author-bio">My name is Mohammed Kamil , I am a Sudanese software developer , eager to learn any thing in the realm of computer and software engineering</div>
        
      </div>
      
    </section>
    <ul class="pager">
      
      <li class="previous"><a href="https://mohadkamil.tech/posts/microservices-the-forgotton-human-element/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
      
      <li class="next"><a href="https://mohadkamil.tech/posts/creatingdevbox/">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
  </footer>
</article>

  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      
    </div>
    <div class="sns-links hidden-print">
  
  
  <a href="https://twitter.com/kamlan19922" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/mohadkamil" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  
  <a href="https://linkedin.com/in/mohammed-kamil-80bb0495" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
</div>

  </footer>

  <script src="https://mohadkamil.tech/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-114679477-1', 'auto');
    ga('send', 'pageview');
  </script>
  
  
  <script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
  for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
  mixpanel.init("a57fe3842b9f00ed799be75b1277d6f9");</script>
  
</body>
</html>

